# name: test/sql/storage/compression/rle_sorted/rle_sort_compression_ratio.test
# description: Test whether the compression ratio is better after sorting
# group: [rle_sorted]

## load the DB from disk
#load __TEST_DIR__/test_rle_sorting.db
#
#statement ok
#PRAGMA wal_autocheckpoint='1TB';
#
#statement ok
#PRAGMA force_compression='rle'
#
#statement ok
#PRAGMA force_compression_sorting=false
#
#statement ok
#CREATE TABLE nosorting AS SELECT (i/5)::INT64 FROM range(0, 2500000) tbl(i);
#
#statement ok
#checkpoint;
#
#statement ok
#PRAGMA wal_autocheckpoint='1TB';
#
#statement ok
#PRAGMA force_compression='rle'
#
#statement ok
#PRAGMA force_compression_sorting=true
#
#statement ok
#CREATE TABLE sorting AS SELECT (i/10)::INT64 FROM range(0, 2500000) tbl(i);
#
#statement ok
#checkpoint
#
#mode output_result
#
#statement ok
#select count(distinct block_id) from pragma_storage_info('sorting') where segment_type not in('VARCHAR', 'VALIDITY')
#
#statement ok
#select count(distinct block_id) from pragma_storage_info('nosorting') where segment_type not in('VARCHAR', 'VALIDITY')

